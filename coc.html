<!doctype html>
<meta charset="utf-8">
<title>SVG手書き文字ジェネレーター（上下分割フェードアウト 完全版）</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";margin:24px;line-height:1.6}
  .preview{border:1px dashed #bbb;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#fafafa;min-height:460px}
</style>

<div class="preview" id="previewArea"></div>

<script>
const W=768,H=432;
const text="Call of Cthulhu";
const color="#000";
const size=72;
const family="serif";
const letter=2;

const measure=document.createElement('canvas').getContext('2d');
measure.font=`${size}px ${family}`;
function w(ch){return measure.measureText(ch).width;}
const chars=[...text];
const widths=chars.map(w);
const total=widths.reduce((a,b)=>a+b,0)+(chars.length-1)*letter;
let x=(W-total)/2,begin='0s',id=0;
const baseY=H/2+size*0.35;
const strokeW=size*0.38;
const defs=[],lines=[],fills=[];
chars.forEach((ch,i)=>{
  const cw=widths[i];
  if(ch===' '){x+=cw+letter;return;}
  const thisId=`a${++id}`;
  const dash=cw*12;
  const dur=(0.7*(cw/size)).toFixed(3)+'s';
  defs.push(`<mask id="m${id}"><text x="${x}" y="${baseY}" font-family="${family}" font-size="${size}" fill="none" stroke="#fff" stroke-width="${strokeW}" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="${dash}" stroke-dashoffset="${dash}">${ch}<animate attributeName="stroke-dashoffset" from="${dash}" to="0" dur="${dur}" begin="${begin}" fill="freeze"/></text></mask>`);
  lines.push(`<text x="${x}" y="${baseY}" font-family="${family}" font-size="${size}" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="${dash}" stroke-dashoffset="${dash}">${ch}<animate id="${thisId}" attributeName="stroke-dashoffset" from="${dash}" to="0" dur="${dur}" begin="${begin}" fill="freeze"/></text>`);
  fills.push(`<text x="${x}" y="${baseY}" font-family="${family}" font-size="${size}" fill="${color}" mask="url(#m${id})">${ch}</text>`);
  begin=`${thisId}.end+0.08s`;
  x+=cw+letter;
});
const last=`a${id}`;
const halfY=H/2;
const animDur='1.2s';

const svg=`<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
  <defs>${defs.join('\n')}</defs>

  <g id="all">
    ${lines.join('\n')}
    ${fills.join('\n')}
  </g>

  <!-- 上半分 -->
  <mask id="maskTop"><rect x="0" y="0" width="${W}" height="${halfY}" fill="#fff"/></mask>
  <!-- 下半分 -->
  <mask id="maskBottom"><rect x="0" y="${halfY}" width="${W}" height="${halfY}" fill="#fff"/></mask>

  <!-- 上が右へ、下が左へ -->
  <use href="#all" mask="url(#maskTop)">
    <animateTransform attributeName="transform" type="translate" from="0 0" to="200 0" dur="${animDur}" begin="${last}.end+1s" fill="freeze"/>
    <animate attributeName="opacity" from="1" to="0" dur="${animDur}" begin="${last}.end+1s" fill="freeze"/>
  </use>
  <use href="#all" mask="url(#maskBottom)">
    <animateTransform attributeName="transform" type="translate" from="0 0" to="-200 0" dur="${animDur}" begin="${last}.end+1s" fill="freeze"/>
    <animate attributeName="opacity" from="1" to="0" dur="${animDur}" begin="${last}.end+1s" fill="freeze"/>
  </use>

  <!-- 元の文字（静止体）も同時にフェードアウト -->
  <animate xlink:href="#all" attributeName="opacity" from="1" to="0" dur="${animDur}" begin="${last}.end+1s" fill="freeze"/>
</svg>`;

document.getElementById('previewArea').innerHTML=svg;
</script>
