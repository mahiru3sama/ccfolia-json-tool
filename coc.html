<!doctype html>
<meta charset="utf-8">
<title>SVG手書き文字ジェネレーター（複製→上下分割消滅）</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans";margin:24px;line-height:1.6}
  fieldset{border:1px solid #ccc;border-radius:8px;padding:12px;margin-bottom:16px}
  label{display:block;font-size:13px;margin:6px 0 2px}
  input,select,button,textarea{font:inherit}
  input[type="text"],input[type="number"],select{width:100%;box-sizing:border-box;padding:6px;border:1px solid #bbb;border-radius:6px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .preview{border:1px dashed #bbb;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#fafafa;min-height:460px}
  textarea{width:100%;box-sizing:border-box;height:200px;padding:8px;border:1px solid #bbb;border-radius:8px;font-family:monospace;font-size:12px}
  .hint{font-size:12px;color:#555}
</style>

<h1>SVG手書き文字ジェネレーター（複製→上下分割消滅）</h1>

<fieldset>
  <legend>設定</legend>
  <div class="row">
    <div>
      <label>① テキスト</label>
      <input id="text" type="text" value="Call of Cthulhu">
    </div>
    <div>
      <label>② 文字色</label>
      <input id="color" type="text" value="#000000">
    </div>
  </div>
  <div class="row">
    <div>
      <label>③ 文字サイズ（px）</label>
      <input id="fontSize" type="number" value="72" min="8" step="1">
    </div>
    <div>
      <label>④ フォント</label>
      <select id="fontFamily">
        <option value="serif" selected>serif</option>
        <option value="sans-serif">sans-serif</option>
        <option value="monospace">monospace</option>
      </select>
    </div>
  </div>
  <div class="row">
    <div>
      <label>⑤ 文字間（px）</label>
      <input id="letterSpacing" type="number" value="2" step="0.5">
    </div>
    <div>
      <label>⑥ フェード秒数（s）</label>
      <input id="fadeSec" type="number" value="1.2" step="0.1">
    </div>
  </div>
  <div class="actions">
    <button id="build">SVGを生成</button>
    <button id="copy">SVGをコピー</button>
    <button id="download">SVGをダウンロード</button>
  </div>
</fieldset>

<fieldset>
  <legend>プレビュー</legend>
  <div class="preview" id="previewArea">ここにSVGが表示されます</div>
</fieldset>

<fieldset>
  <legend>生成SVGコード</legend>
  <textarea id="code" readonly></textarea>
</fieldset>

<script>
const measureCanvas=document.createElement('canvas');
const mctx=measureCanvas.getContext('2d');
function measureWidth(ch,size,family){mctx.font=`${size}px ${family}`;return mctx.measureText(ch).width;}
function esc(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

function buildSVG(){
  const txt=document.getElementById('text').value||'';
  const color=document.getElementById('color').value||'#000';
  const size=Number(document.getElementById('fontSize').value||72);
  const family=document.getElementById('fontFamily').value||'serif';
  const letter=Number(document.getElementById('letterSpacing').value||0);
  const fadeSec=Number(document.getElementById('fadeSec').value||1.2);

  const W=768,H=432,baseY=H/2+size*0.35;
  const chars=[...txt];
  const widths=chars.map(c=>measureWidth(c,size,family));
  const total=widths.reduce((a,b)=>a+b,0)+(chars.length-1)*letter;
  let x=(W-total)/2,begin='0s',id=0;
  const strokeW=size*0.38;
  const defs=[],lines=[],fills=[];
  chars.forEach((ch,i)=>{
    const w=widths[i];
    if(ch===' '){x+=w+letter;return;}
    const thisId=`a${++id}`;
    const dash=w*12;
    const dur=(0.7*(w/size)).toFixed(3)+'s';
    defs.push(`<mask id="m${id}"><text x="${x}" y="${baseY}" font-family="${family}" font-size="${size}" fill="none" stroke="#fff" stroke-width="${strokeW}" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="${dash}" stroke-dashoffset="${dash}">${esc(ch)}<animate attributeName="stroke-dashoffset" from="${dash}" to="0" dur="${dur}" begin="${begin}" fill="freeze"/></text></mask>`);
    lines.push(`<text x="${x}" y="${baseY}" font-family="${family}" font-size="${size}" fill="none" stroke="${color}" stroke-width="2" stroke-dasharray="${dash}" stroke-dashoffset="${dash}">${esc(ch)}<animate id="${thisId}" attributeName="stroke-dashoffset" from="${dash}" to="0" dur="${dur}" begin="${begin}" fill="freeze"/></text>`);
    fills.push(`<text x="${x}" y="${baseY}" font-family="${family}" font-size="${size}" fill="${color}" mask="url(#m${id})">${esc(ch)}</text>`);
    begin=`${thisId}.end+0.08s`;
    x+=w+letter;
  });
  const last=`a${id}`;
  const halfY=H/2;

  const svg=`<svg xmlns="http://www.w3.org/2000/svg" width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
  <defs>${defs.join('\n')}</defs>

  <!-- 下レイヤー（描き終わった後フェードアウト） -->
  <g id="layer_bottom">
    ${lines.join('\n')}
    ${fills.join('\n')}
    <animate xlink:href="#layer_bottom" attributeName="opacity" from="1" to="0" dur="${fadeSec}s" begin="${last}.end+0.5s" fill="freeze"/>
  </g>

  <!-- 上レイヤー：分割して左右移動 -->
  <g id="layer_top">
    ${lines.join('\n')}
    ${fills.join('\n')}
  </g>

  <!-- 上半分・下半分マスク -->
  <mask id="maskTop"><rect x="0" y="0" width="${W}" height="${halfY}" fill="#fff"/></mask>
  <mask id="maskBottom"><rect x="0" y="${halfY}" width="${W}" height="${halfY}" fill="#fff"/></mask>

  <use href="#layer_top" mask="url(#maskTop)">
    <animateTransform attributeName="transform" type="translate" from="0 0" to="200 0" dur="${fadeSec}s" begin="${last}.end+0.5s" fill="freeze"/>
    <animate attributeName="opacity" from="1" to="0" dur="${fadeSec}s" begin="${last}.end+0.5s" fill="freeze"/>
  </use>
  <use href="#layer_top" mask="url(#maskBottom)">
    <animateTransform attributeName="transform" type="translate" from="0 0" to="-200 0" dur="${fadeSec}s" begin="${last}.end+0.5s" fill="freeze"/>
    <animate attributeName="opacity" from="1" to="0" dur="${fadeSec}s" begin="${last}.end+0.5s" fill="freeze"/>
  </use>
</svg>`;

  document.getElementById('code').value=svg;
  document.getElementById('previewArea').innerHTML=svg;
}

document.getElementById('build').onclick=e=>{e.preventDefault();buildSVG();};
document.getElementById('copy').onclick=e=>{e.preventDefault();const t=document.getElementById('code');t.select();document.execCommand('copy');};
document.getElementById('download').onclick=e=>{e.preventDefault();const s=document.getElementById('code').value;const b=new Blob([s],{type:'image/svg+xml'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='handwrite.svg';a.click();URL.revokeObjectURL(u);};

buildSVG();
</script>
